---
title: "Laboration-1-Surveymetodik-grupp-161"
author:
- Åke Rosvall
- Michael Debebe
date: '2021-04-29'
output:
  pdf_document:
    fig_caption: yes
    number_sections: yes
  word_document: default
  html_document:
    df_print: paged
geometry: top=100pt,bottom=100pt,left=68pt,right=66pt
subtitle: 732G38
header-includes:
- \usepackage{float}
- \usepackage{longtable}
- \usepackage{caption}
- \usepackage{fancyhdr}
- \usepackage{titling}
- \usepackage[swedish, english]{babel}
- \renewcommand{\headrulewidth}{0pt}
- \renewcommand{\and}{\\}
- \pretitle{\centering\vspace{0cm}{\large Labbrapport i Statistik \par}\vspace{4cm}\Huge\textbf}
- \posttitle{\vspace{1cm}\large\textbf{}\par}
- \preauthor{\centering\vspace{4cm}\normalsize}
- \postauthor{\par\vspace{4cm}}
- \predate{\centering{\normalsize Avdelningen för Statistik och maskininlärning \\
  Institutionen för datavetenskap \\ Linköpings universitet \par}}
- \postdate{\par\vspace{2cm}}
- \raggedbottom
---

<!-- Väljer språk till svenska för automatiska titlar -->
\selectlanguage{swedish}

<!-- Byter språket på figur- och tabellbeskrivningar till angivna namn -->
\captionsetup[table]{name = Tabell}
\setcounter{table}{0}
\captionsetup[figure]{name = Figur}
\setcounter{figure}{0}

<!-- Anger att tabellbeskrivningar hamnar ovanför tabellen -->
\floatstyle{plaintop}
\restylefloat{table}

<!-- Anger sidnumreringens position -->
\fancyhf{}
\fancyfoot[C]{\thepage}
\pagestyle{fancy}

<!-- Tar bort sidnumrering för förteckningar och titelsidan -->
\pagenumbering{gobble}

<!-- Anger sidbrytning -->
\clearpage

<!-- Skapar en innehållsförteckning och anger djupet av rubrikerna som ska visas -->
\setcounter{tocdepth}{3}
\tableofcontents

<!-- Anger sidbrytning -->
\clearpage

<!-- Börjar sidnumreringen på sida 1 efter att alla förteckningar visats -->
\pagenumbering{arabic}
\setcounter{page}{1}

<!-- Börjar med kapitel 1 -->
# Introduktion
Introducera laborationen; de datamaterial som används, målen med uppgifterna och annat förberedande arbete. Detta kan inkludera inläsning av data och paket där all form av output ska vara gömt såvida inget annat anges. För att undvika att förlora värden använder vi oss också av seed nummer 1112

```{r echo = FALSE, include = FALSE}
#include = FALSE tar bort alla utskrifter som kommer från laddning av data eller paket
options(scipen = 100)
libraries <- c("survey", "dplyr", "ggplot2", "knitr", "GGally", "xtable")

#require(libraries)
invisible(lapply(libraries, require, character.only = TRUE))

```
{r sex_age, results = "markup"}
knitr::opts_chunk$set(echo = T, 
# här skriver vi ut att vi vill visa koden i denna chunk
                      results = "hide") 

```{r sex_age, results = "markup"}
knitr::opts_chunk$set(echo = T, 
# här skriver vi ut att vi vill visa koden i denna chunk
                      results = "hide")  # men vi vill inte skriva ut resultaten från koden)

# Lite kommentarer och berakningar som inte syns i pdf filen
#vi laddar in datat och gör lite ändringar till den, så som att ta bort bortfall m.m.

agpop <-read.table("https://raw.githubusercontent.com/vriken/732G38/production/agpop.dat", header = TRUE, sep = ",")

agpop <-agpop[agpop$ACRES92 > 0 & agpop$ACRES87 > 0,]
OSUindex <-sample(size=300, 1:nrow(agpop), replace = FALSE)
agOSUdata <- agpop[OSUindex,]
fpc.srs <-rep(nrow(agpop),300)
agOSU <- svydesign(ids = ~1, data = agOSUdata, fpc =  fpc.srs)

total <- svytotal(~ACRES92, design = agOSU)
medel <- svymean(~ACRES92, design = agOSU)

dennaSkaVisas <- confint(medel)

byRegion <- svyby(~ACRES92, by = ~REGION, design = agOSU, FUN = svymean)

```

Vi skriver denna labb om datasetet agpop.dat. Datasetet handlar om olika jordbruksgårdar.

Vi har hämtat datasetet agpop som består av `r nrow(agpop)` observationer. De första observationerna syns nedan.
```{r SCB, results = 'markup'}
opts_chunk$set(echo = FALSE)
head(agpop,n=20, ncol = 10)  # Specifies to put the caption on top of the table
```

<!-- Anger sidbrytning -->
\clearpage


\pagebreak


# Uppgifter

##  2.1 Urvalsprocessen i R

a) Vilken information får du om surveyobjektet agOSU? Beskriv samtliga delar. Är det någon informationsom du anser saknas i detta objekt för att beskriva det urval som vi gjort?

```{r echo = FALSE, results = 'markup'}
opts_chunk$set(echo = FALSE, # här skriver vi ut att vi vill visa koden i denna chunk 
                      results = "hide")
itk <-as.array(summary(agpop$ACRES92))
kable(t(itk))
```

Vi anser att det är en självständig urvalsdesign. Sannolikheter där det som vanligt svaras på minimum, första kvartil, median, tredje kvartil och maximum.

b) Tolka dessa skattningar som du fått ut från dessa två funktioner

```{r echo = FALSE, results = 'markup'}
opts_chunk$set(echo = FALSE, # här skriver vi ut att vi vill visa koden i denna chunk 
                      results = "hide")
kable(svymean(~ACRES92, design = agOSU))
kable(svytotal(~ACRES92, design = agOSU)) 
```

Vi påstår att medelfelet är högt i förhållande till det medelvärde och totalvärde vi jämför med.

 c) Vad får du för konfidensintervall? Täcker intervallet det sanna värdet i populationen du dragit ditturval från?

Konfidensintervallet som retuernas återfinns i tabellen nedan
Vi räknar ut detta med hjälp av funktionen `confint() vars standardkonfidens ligger på 95%
```{r echo = FALSE,eval=FALSE}
results = 'markup'}
opts_chunk$set(echo = FALSE, # här skriver vi ut att vi vill visa koden i denna chunk 
                      results = "hide")
kable(dennaSkaVisas)
```
<!-- Anger sidbrytning -->
\clearpage


\pagebreak
##  2.2 Skattningar i redovisningsgrupper

a) Skapa variabeln NonLargeFarms med koden nedan och skatta medelvärdet i populationen med tillhörande konfidensintervall. Tolka intervallet och jämför med det sanna medelvärdet.




```{r echo = FALSE}
agOSU$variables$nonLargeFarms <- agOSU$variables$FARMS92 - agOSU$variables$LARGEF92
meanLargeFarms <- svymean(~nonLargeFarms, design = agOSU)
kable(meanLargeFarms)
```
Här visas på vänster sida medelvärdet och på höger sida medelfelet. Vi tolkar detta som att medelvärdet för stora jordbruksgårdar är likt det sanna medelvärdet för populationen.
<!-- Anger sidbrytning -->
\clearpage


\pagebreak
##  2.3 Skattningar i redovisningsgrupper

 a) Finns det någon skillnad mellan de olika regionerna när det gäller ytan som används för jordbruk? Vilken region har störst yta för jordbruk i urvalet?


```{r echo = FALSE, results = "asis"}
print(xtable(head(byRegion), caption="En tabell med data som visar skillnaderna mellan regionerna"), 
    include.rownames = FALSE, # Removes the row numbering 
    table.placement = "H", # Specifies the placement of the table, note that these two commands need to be placed inside the print() and not the xtable()
    comment = FALSE,
    caption.placement = "top")  # Specifies to put the caption on top of the table
```
Från detta kan vi säga att det finns en skillnad mellan regionerna. Bedömt till värdena att den region med störst yta är region väst foljt av centrala delarna av den nordliga regionen.


b) Vilka skillnader finns det mellan att använda subset() och svyby()? Bör det bli en skillnad med tanke på att två olika funktioner använts?

När man använder svyby har man en möjlighet att välja vad datasetet ska sorteras på och vilken eventuell funktion som ska användas i samband med funktionen. Detta betyder alltså att det kan finnas skillnader på funktionerna, men utan några speciella förfrågningar gör dem samma sak.
<!-- Anger sidbrytning -->
\clearpage


\pagebreak
##  2.4 Estimatorers bias, varians och täckningsgrad.

a) Beräkna täckningsgraden för intervallskattningen, d.v.s. andelen utav urvalen där det skattade konfidensintervallet täcker det sanna värdet. Vad förväntar du dig för värde och hur bör dessa värden relatera till varandra?
```{r, echo = FALSE}
func <-function(urvalsstorlek, antalet_urvalet, pop){
  urvalsstorlek <- 400
  antal_urval <- 10000
  andlighetskorrektion <- rep(nrow(agpop), urvalsstorlek)
  spara <- matrix(data = NA, nrow = antal_urval, ncol = 2)
  
  for(nr in 1:antal_urval){
    urval <- sample(x = 1:nrow(agpop),
                    size = urvalsstorlek,
                    replace = FALSE)
    survey_objekt <- svydesign(ids = ~1,
                               data = agpop[urval, c("ACRES92", "ACRES87")],
                               fpc = andlighetskorrektion)
    medel <- svymean(~ACRES92, survey_objekt)
    konfidens_intervall <- confint(medel, level = 0.9)
    # Om sanna värdet täcks av intervallet blir resultatet av funktionen 1,
    # därav == 1 för att generera en TRUE/FALSE vektor
    tacker_intervallet <- findInterval(x = mean(pop),
                                       vec = konfidens_intervall) == 1
    spara[nr,] <- c(medel[1], tacker_intervallet)
  }
  
  return(spara)
}
```

```{r, echo = FALSE}
numberList <- matrix(func(10000,400,agpop$ACRES92)[,1])
onesAndZeros <- matrix(func(10000,400,agpop$ACRES92)[,2])
combined <- as.data.frame(cbind(numberList,onesAndZeros))
placeholder <- filter(combined, V2 ==0 )
täckningsgrad <-placeholder/10000
colnames(combined) <-c("Medelvärde", "Intervalltäckande")


```


Antal medelvärdesskattningar som inte täcker de verkliga spannet är `r nrow(placeholder)` av 10000 fall, vilket innebär att teckningsgraden `r 1-nrow(placeholder)/10000`% 

b) Visualisera medelvärdesskattningar i ett histogram. Lägg också in det sanna medelvärdet i diagrammet som en vertikallinje. Motivera varför detta diagram bevisar eller motbevisar centrala gränsvärdessatsen
```{r, echo = FALSE, message=FALSE}
musten <-ggplot(data = combined, aes(x = Medelvärde)) +
  geom_histogram() +
  xlab("Medelvärde") +
  theme_bw() +
  ylab("Antal") +
  geom_vline(xintercept = combined$vline, linetype = "dashed") +
  ggtitle("Medelvärdesskattningar", subtitle = "Med sanna medelvärde")+
  geom_vline(xintercept = mean(agpop$ACRES92), linetype="dashed")
print(musten)

```
Histogrammet bevisar tydligt centrala gränsvärdessatsen, som i grund och botten säger att om det adderas ett stort antal oberoende slumpmässiga variabler med ändliga varianser kommer summan att gå mot en normalfördelning som tydligt visas i histogrammet.

c) Beräkna det genomsnittliga värdet på samtliga 10 000 medelvärdesskattningar. Vad förväntar du dig för värde? Vilka slutsatser kan vi dra om skattningsmetoden utifrån denna jämförelse?
```{r, echo=FALSE}
kable(mean(combined$Medelvärde))
```

Det vi förväntade oss var ett medelvärde som skulle liga nära det sanna medelvärdet +- något medelfel, detta medelfel kommer att räknas ut i nästa uppgift. Vi tror ochså att medelvärdet kommer ligga nära den vertikala linje som syns i histogramet


d) Beräkna det teoretiska medelfelet för y¯S

```{r, echo = FALSE}
skattatError <- sqrt((1-300/3042)*(var(agpop$ACRES92)/300))

sannaValues <- c(sd(combined$Medelvärde), mean(combined$Medelvärde))
skattadeValues <- c(skattatError, "310104")

kable(skattatError)
```

e) Beräkna standardavvikelsen för de 10 000 medelvärdesskattningar som skapats i simuleringen. Hur relaterar du detta värde till det som beräknats i d?
```{r, echo=FALSE}
kable(sd(combined$Medelvärde))
```
Värdena ligger förvånadesvärt nära varandra vilket tyder på att formeln fungerar väldigt bra och att medelvärdet ska fungera att använda som en standardavvikelse när man vill räkna ut ett 95 % konfidensintervall i form av att när en population är större än 30 och fördelningern ser ut att vara normalfördelad finns 95 % av värdena inom 2 standardavvikelser/medelfel.
<!-- Anger sidbrytning -->
\clearpage


\pagebreak

# Lärdomar, problem, övriga kommentarer 
Under detta kapitel kan ni ta upp de saker som ni lärt er, eventuella problem ni stött på och andra saker (kopplade till kursen) som ni tänkt på under arbetet med laborationen. Dessa tankar kan vara bra att ha när det är dags för att repetera kursen, så ni kommer ihåg saker som ni kanske hade lite problem med och fick göra någon speciallösning på eller liknande.

\clearpage

# Referenser